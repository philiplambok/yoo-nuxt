#!/bin/bash
# Run Vitest test suite

# Source common functions
source "$(dirname "$0")/_common"
check_docker

if [ $# -eq 0 ]; then
    echo "ðŸ§ª Running Vitest test suite..."
    echo "ðŸ’¡ Run './dx/test --watch' for watch mode or './dx/test path/to/test.spec.ts' for specific files"
    echo ""
    
    docker run -i --rm \
        -v "$(pwd):/app" \
        -v /app/node_modules \
        yoo-nuxt-todo:dev \
        pnpm test
else
    if [[ "$*" == *"--watch"* ]] || [[ "$*" == *"-w"* ]]; then
        echo "ðŸ”„ Running Vitest in watch mode..."
        echo "ðŸ’¡ Tests will re-run automatically when files change"
        echo "ðŸ›‘ Press 'q' to quit watch mode"
        echo ""
        
        docker run -it --rm \
            -v "$(pwd):/app" \
            -v /app/node_modules \
            yoo-nuxt-todo:dev \
            pnpm test:watch
    else
        echo "ðŸ§ª Running specific test: $*"
        echo ""
        
        docker run -i --rm \
            -v "$(pwd):/app" \
            -v /app/node_modules \
            yoo-nuxt-todo:dev \
            pnpm test "$@"
    fi
fi
